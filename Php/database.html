<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Database</title>
    <link rel="stylesheet" href="../iframe_content.css" />

    <!-- Prism.js CSS -->
    <link rel="stylesheet" href="../Assets/Prism/prism.min.css" />

    <!-- JQuery Script -->
    <script src="../Assets/jquery/jquery.min.js"></script>
  </head>
  <body>
    <div>
      <h1>Database</h1>
    </div>
    <div class="paragraphBox">
      <p>With PHP, we can connect to and manipulate databases.</p>
      <p>
        <span>MySQL</span> is the most popular database system used with PHP.
      </p>
      <p>
        Databases are useful for storing information categorically. A company
        may have a database with the following tables:
      </p>
      <ul>
        <li>Employees</li>
        <li>Products</li>
        <li>Customers</li>
        <li>Orders</li>
      </ul>
    </div>

    <hr />

    <div>
      <h1>Connect to MySQL</h1>
    </div>
    <div class="paragraphBox">
      <p>We can work with a MySQL database using:</p>
      <ul>
        <li>MySQLi extension (the "i" stands for improved)</li>
        <li>PDO (PHP Data Objects)</li>
      </ul>

      <h2><b>MySQLi or PDO</b></h2>
      <p>Both MySQLi and PDO have their advantages:</p>
      <p>
        <span>PDO</span> will work on 12 different database systems, whereas
        MySQLi will only work with MySQL databases.
      </p>
      <p>
        If you have to switch your project to use another database,
        <span>PDO</span> makes the process easy. You only have to change the
        connection string and a few queries.
      </p>
      <p>
        With <span>MySQLi</span>, you will need to rewrite the entire code -
        queries included.
      </p>
      <p>Both are object-oriented, but MySQLi also offers a procedural API.</p>
      <p>
        Both support Prepared Statements. Prepared Statements protect from SQL
        injection, and are very important for web application security.
      </p>
      <p>
        In this, and in the following chapters we demonstrate three ways of
        working with PHP and MySQL:
      </p>
      <ul>
        <li>MySQLi (object-oriented)</li>
        <li>MySQLi (procedural)</li>
        <li>PDO</li>
      </ul>
    </div>

    <hr />

    <div>
      <h1>Open a Connection to MySQL</h1>
    </div>
    <div class="paragraphBox">
      <p>
        Before we can access data in the MySQL database, we need to be able to
        connect to the server:
      </p>
      <div class="scriptBox" id="roundbox">
        <p>Example (MySQLi Object-Oriented)</p>
        <pre><code class="language-php">
          &lt;?php
          // Storing MySQL details in variables
          $servername = "localhost";
          $username = "username";
          $password = "password";

          // Create connection
          $conn = new mysqli($servername, $username, $password);

          // Check connection
          if ($conn->connect_error) {
            die("Connection failed: " . $conn->connect_error);
          }
          echo "Connected successfully";
          ?&gt;
        </code></pre>
      </div>
      <div class="note">
        <p>
          On the object-oriented <span>$connect_error</span> was broken until
          PHP 5.2.9 and 5.3.0. If you need to ensure compatibility with PHP
          versions prior to 5.2.9 and 5.3.0, use the following code instead:
        </p>
      </div>
      <pre><code class="language-php">
        // Check connection
        if (mysqli_connect_error()) {
          die("Database connection failed: " . mysqli_connect_error());
        }
      </code></pre>
      <div class="scriptBox" id="roundbox">
        <p>Example (MySQLi Procedural)</p>
        <pre><code class="language-php">
          &lt;?php
          // Storing MySQL details in variables
          $servername = "localhost";
          $username = "username";
          $password = "password";

          // Create connection
          $conn = new mysqli($servername, $username, $password);

          // Check connection
          if (!$conn) {
            die("Connection failed: " . mysqli_connect_error);
          }
          echo "Connected successfully";
          ?&gt;
        </code></pre>
      </div>

      <div class="scriptBox" id="roundbox">
        <p>Example (PDO)</p>
        <pre><code class="language-php">
          &lt;?php
          // Storing MySQL details in variables
          $servername = "localhost";
          $username = "username";
          $password = "password";
          $dbname = "testing";

          try {
            // Create connection
            $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);

            // set the PDO error mode to exception
            $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            echo "Connected successfully";
          } catch(PDOException $e) {
            echo "Connection failed: " . $e->getMessage();
          }
          ?&gt;
        </code></pre>
      </div>
      <p class="note">
        <b>Note:</b> In the PDO example above we have also
        <b>specified a database (myDB)</b>. PDO require a valid database to
        connect to. If no database is specified, an exception is thrown.
      </p>
      <p>
        <b>Tip:</b> A great benefit of PDO is that it has an exception class to
        handle any problems that may occur in our database queries. If an
        exception is thrown within the <span>try{ }</span> block, the script
        stops executing and flows directly to the first
        <span>catch(){ }</span> block.
      </p>
    </div>

    <hr />

    <div>
      <h1>Close the Connection</h1>
    </div>
    <div class="paragraphBox">
      <p>
        The connection will be closed automatically when the script ends. To
        close the connection before, use the following:
      </p>

      <h2>MySQLi Object-Oriented:</h2>
      <pre><code class="language-php">
        $conn->close();
      </code></pre>

      <h2>MySQLi Procedural:</h2>
      <pre><code class="language-php">
        mysqli_close($conn);
      </code></pre>

      <h2>PDO:</h2>
      <pre><code class="language-php">
        $conn = null;
      </code></pre>
    </div>

    <hr />

    <div>
      <h1>Create a MySQL Database</h1>
    </div>
    <p>
      You will need special <span>CREATE</span> privileges to create or to
      delete a MySQL database.
    </p>
    <p>
      The <span>CREATE DATABASE</span> statement is used to create a database in
      MySQL.
    </p>
    <p>The following examples create a database named "myDB":</p>
    <div class="paragraphBox">
      <div class="scriptBox" id="roundbox">
        <p>Example (MySQLi Object-Oriented)</p>
        <pre><code class="language-php">
          &lt;?php
          // Create connection
          $conn = new mysqli($servername, $username, $password);

          // Check connection
          if ($conn->connect_error) {
            die("Connection failed: " . $conn->connect_error);
          }
          
          // Create database
          $sql = "CREATE DATABASE myDB";
          if ($conn->query($sql) === TRUE) {
            echo "Database created successfully";
          } else {
            echo "Error creating database: " . $conn->error;
          }

          $conn->close();
          ?&gt;
        </code></pre>
      </div>
      <p class="note">
        <b>Note:</b> When you create a new database, you must only specify the
        first three arguments to the mysqli object (servername, username and
        password).
      </p>
    </div>
    <div class="scriptBox" id="roundbox">
      <p>Example (MySQLi Procedural)</p>
      <pre><code class="language-php">
        &lt;?php
        // Create connection
        $conn = new mysqli($servername, $username, $password);

        // Check connection
        if (!$conn) {
          die("Connection failed: " . mysqli_connect_error);
        }
        
        // Create database
        $sql = "CREATE DATABASE myDB";
        if (mysqli_query($conn, $sql)) {
          echo "Database created successfully";
        } else {
          echo "Error creating database: " . mysqli_error($conn);
        }

        mysqli_close($conn);
        ?&gt;
      </code></pre>
    </div>
    <div class="scriptBox" id="roundbox">
      <p>Example (PDO)</p>
      <pre><code class="language-php">
        &lt;?php
        try {
          // Create connection
          $conn = new PDO("mysql:host=$servername", $username, $password);

          // set the PDO error mode to exception
          $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

          // Create database
          $sql = "CREATE DATABASE myDBPDO";

          // use exec() because no results are returned
          $conn->exec($sql);  
          echo "Database created successfully&lt;br&gt;";
        } catch(PDOException $e) {
          echo "Connection failed: " . $e->getMessage();
        }

        $conn = null;
        ?&gt;
      </code></pre>
    </div>

    <hr />

    <div>
      <h1>Create a MySQL Table</h1>
    </div>
    <div class="paragraphBox">
      <p>
        A database table has its own unique name and consists of columns and
        rows.
      </p>
      <p>
        The <span>CREATE TABLE</span> statement is used to create a table in
        MySQL.
      </p>
      <p>
        We will create a table named "MyGuests", with five columns: "id",
        "firstname", "lastname", "email" and "reg_date":
      </p>
      <pre><code class="language-php">
        CREATE TABLE MyGuests (
        id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
        firstname VARCHAR(30) NOT NULL,
        lastname VARCHAR(30) NOT NULL,
        email VARCHAR(50),
        reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        )
      </code></pre>
      <p>The following examples shows how to create the table in PHP:</p>
    </div>
    <div class="scriptBox" id="roundbox">
      <p>Example (MySQLi Object-Oriented)</p>
      <pre><code class="language-php">
        &lt;?php
        // Create connection
        $conn = new mysqli($servername, $username, $password, $dbname);

        // Check connection
        
        // Create table
        $sql = "CREATE TABLE MyGuests (...)";

        if ($conn->query($sql) === TRUE) {
          echo "Table MyGuests created successfully";
        } else {
          echo "Error creating database: " . $conn->error;
        }
        ?&gt;
      </code></pre>
    </div>

    <div class="scriptBox" id="roundbox">
      <p>Example (MySQLi Procedural)</p>
      <pre><code class="language-php">
        &lt;?php
        // Create connection
        $conn = new mysqli($servername, $username, $password, $dbname);

        // Check connection
        
        // Create table
        $sql = "CREATE TABLE MyGuests (...)";

        if (mysqli_query($conn, $sql)) {
          echo "Table MyGuests created successfully";
        } else {
          echo "Error creating database: " . mysqli_error($conn);
        }
        ?&gt;
      </code></pre>
    </div>

    <div class="scriptBox" id="roundbox">
      <p>Example (PDO)</p>
      <pre><code class="language-php">
        &lt;?php
        try {
          // Create connection
          $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);

          // set the PDO error mode to exception
          $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

          // Create table
          $sql = "CREATE TABLE MyGuests (...)";

          // use exec() because no results are returned
          $conn->exec($sql);  
          echo "Table MyGuests created successfully";
        } catch(PDOException $e) {
          echo "Connection failed: " . $e->getMessage();
        }
        ?&gt;
      </code></pre>
    </div>

    <hr />

    <div>
      <h1>Insert Data</h1>
    </div>
    <div class="paragraphBox">
      <p>
        After a database and a table have been created, we can start adding data
        in them.
      </p>
      <p>Here are some syntax rules to follow:</p>
    </div>

    <!-- Prism.js JavaScript -->
    <script src="../Assets/Prism/prism.min.js"></script>
    <script src="../Assets/Prism/prism-php.min.js"></script>
  </body>
</html>
